{% extends 'base.html' %}
{% load static %}

{% block title %}Our Team - Development Decision Support (DDS){% endblock %}

{% block extra_css %}
<style>
  /* Custom animations and transitions */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes slideIn {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  .animate-fade-in-up {
    animation: fadeInUp 0.8s ease-out forwards;
  }

  .animate-slide-in {
    animation: slideIn 0.3s ease-out forwards;
  }

  /* Enhanced hover effects */
  .team-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  .team-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
  }

  .team-image {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }

  .team-image::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(147, 51, 234, 0.1));
    opacity: 0;
    transition: opacity 0.3s ease;
    z-index: 1;
  }

  .team-card:hover .team-image::before {
    opacity: 1;
  }

  .team-card:hover .team-image img {
    transform: scale(1.05);
  }

  /* Modal improvements */
  .modal-backdrop {
    backdrop-filter: blur(4px);
    background-color: rgba(0, 0, 0, 0.5);
  }

  .modal-content {
    max-height: 90vh;
    overflow-y: auto;
  }

  /* Gradient text */
  .gradient-text {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* Professional badge styles */
  .contact-badge {
    display: inline-flex;
    align-items: center;
    padding: 0.5rem 1rem;
    border-radius: 50px;
    background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
    border: 1px solid #d1d5db;
    transition: all 0.2s ease;
  }

  .contact-badge:hover {
    background: linear-gradient(135deg, #e5e7eb, #d1d5db);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  /* Loading skeleton */
  .skeleton {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
  }

  @keyframes loading {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }

  /* Responsive improvements */
  @media (max-width: 768px) {
    .team-card {
      margin-bottom: 2rem;
    }
    
    .modal-content {
      margin: 1rem;
      max-height: 80vh;
    }
  }

  /* Section dividers */
  .section-divider {
    position: relative;
    text-align: center;
    margin: 3rem 0;
  }

  .section-divider::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, #e5e7eb, transparent);
  }

  .section-divider span {
    background: white;
    padding: 0 2rem;
    color: #6b7280;
    font-weight: 500;
  }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section with Enhanced Design -->
<section class="relative bg-gradient-to-br from-slate-50 via-white to-blue-50 overflow-hidden">
  <!-- Background Pattern -->
  <div class="absolute inset-0 opacity-5">
    <div class="absolute inset-0" style="background-image: url('data:image/svg+xml,%3Csvg width="60" height="60" viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="none" fill-rule="evenodd"%3E%3Cg fill="%23000000" fill-opacity="0.1"%3E%3Ccircle cx="30" cy="30" r="2"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
  </div>
  
  <div class="relative container mx-auto px-4 py-20 lg:py-32">
    <div class="max-w-4xl mx-auto text-center">
      <h1 class="text-5xl md:text-6xl lg:text-7xl font-bold mb-6 animate-fade-in-up">
        Our <span class="gradient-text">Team</span>
      </h1>
      <p class="text-xl md:text-2xl text-gray-600 max-w-3xl mx-auto leading-relaxed animate-fade-in-up" style="animation-delay: 0.2s;">
        Meet the dedicated professionals behind DDS's success in data collection and research across Africa.
      </p>
      <div class="mt-8 flex justify-center animate-fade-in-up" style="animation-delay: 0.4s;">
        <div class="w-24 h-1 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full"></div>
      </div>
    </div>
  </div>
</section>

<!-- Main Content -->
<main class="container mx-auto px-4 py-16 lg:py-24">
  <!-- Team Members Section -->
  {% if leadership_team %}
  <section class="mb-20">
    <div class="text-center mb-16">
      <h2 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
        Team Members
      </h2>
      <p class="text-lg text-gray-600 max-w-2xl mx-auto">
        Our diverse team of experts bringing innovation and excellence to every project
      </p>
    </div>

    <!-- Team Members Grid -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 lg:gap-12 max-w-7xl mx-auto">
      {% for member in team_members %}
      <!-- Enhanced Member Card -->
      <article class="team-card bg-white rounded-2xl shadow-lg hover:shadow-2xl border border-gray-100 overflow-hidden group" 
               role="article" 
               aria-labelledby="member-{{ forloop.counter }}-name">
        
        <!-- Member Image -->
        <div class="team-image relative aspect-square overflow-hidden">
          <img
            src="{{ member.image.url }}"
            alt="Portrait of {{ member.name }}, {{ member.position }}"
            class="w-full h-full object-cover transition-transform duration-500"
            loading="lazy"
            onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
          />
          <!-- Fallback for missing images -->
          <div class="absolute inset-0 bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center hidden">
            <svg class="w-16 h-16 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
              <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z"/>
            </svg>
          </div>
        </div>

        <!-- Member Info -->
        <div class="p-6 lg:p-8">
          <h3 id="member-{{ forloop.counter }}-name" 
              class="text-xl lg:text-2xl font-bold text-gray-900 mb-2 group-hover:text-blue-600 transition-colors">
            {{ member.name }}
          </h3>
          <p class="text-base lg:text-lg text-blue-600 font-medium mb-4 uppercase tracking-wide">
            {{ member.position }}
          </p>
          
          <!-- Contact Information -->
          {% if member.email or member.linkedin %}
          <div class="flex items-center justify-center space-x-3 mb-6">
            {% if member.email %}
            <a href="mailto:{{ member.email }}" 
               class="contact-badge text-gray-700 hover:text-blue-600"
               aria-label="Email {{ member.name }}">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                      d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
              </svg>
              <span class="text-sm font-medium">Email</span>
            </a>
            {% endif %}
            
            {% if member.linkedin %}
            <a href="{{ member.linkedin }}" 
               target="_blank" 
               rel="noopener noreferrer"
               class="contact-badge text-gray-700 hover:text-blue-600"
               aria-label="LinkedIn profile of {{ member.name }}">
              <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
                <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
              </svg>
              <span class="text-sm font-medium">LinkedIn</span>
            </a>
            {% endif %}
          </div>
          {% endif %}
          
          <!-- More Info Button -->
          <button
            onclick="toggleModal('{{ forloop.counter }}')"
            class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 px-6 rounded-lg font-medium hover:from-blue-600 hover:to-purple-700 transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
            aria-label="View more details about {{ member.name }}"
          >
            <span class="flex items-center justify-center">
              <span>View Details</span>
              <svg class="w-5 h-5 ml-2 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
              </svg>
            </span>
          </button>
        </div>
      </article>

      <!-- Enhanced Modal -->
      <div id="modal-{{ forloop.counter }}"
           class="fixed inset-0 z-50 hidden overflow-y-auto"
           aria-labelledby="modal-title-{{ forloop.counter }}"
           aria-modal="true"
           role="dialog">
        
        <!-- Modal Backdrop -->
        <div class="modal-backdrop fixed inset-0 transition-opacity duration-300"
             onclick="toggleModal('{{ forloop.counter }}')"
             aria-hidden="true"></div>
        
        <!-- Modal Content -->
        <div class="flex items-center justify-center min-h-screen px-4 py-8">
          <div class="modal-content animate-slide-in relative bg-white rounded-2xl shadow-2xl max-w-2xl w-full border border-gray-200">
            
            <!-- Modal Header -->
            <div class="bg-gradient-to-r from-blue-50 to-purple-50 px-6 py-6 border-b border-gray-200">
              <div class="flex items-center justify-between">
                <div>
                  <h3 id="modal-title-{{ forloop.counter }}"
                      class="text-2xl font-bold text-gray-900">
                    {{ member.name }}
                  </h3>
                  <p class="text-lg text-blue-600 font-medium">
                    {{ member.position }}
                  </p>
                </div>
                <button onclick="toggleModal('{{ forloop.counter }}')"
                        class="text-gray-400 hover:text-gray-600 transition-colors p-2 hover:bg-gray-100 rounded-full"
                        aria-label="Close modal">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                  </svg>
                </button>
              </div>
            </div>
            
            <!-- Modal Body -->
            <div class="px-6 py-6 space-y-6">
              {% if member.bio %}
              <div class="space-y-2">
                <h4 class="text-lg font-semibold text-gray-900 flex items-center">
                  <svg class="w-5 h-5 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                  </svg>
                  Bio
                </h4>
                <div class="prose prose-gray max-w-none">
                  <p class="text-gray-600 leading-relaxed">{{ member.bio|safe }}</p>
                </div>
              </div>
              {% endif %}
              
              {% if member.professional_experience %}
              <div class="space-y-2">
                <h4 class="text-lg font-semibold text-gray-900 flex items-center">
                  <svg class="w-5 h-5 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                  </svg>
                  Professional Experience
                </h4>
                <div class="prose prose-gray max-w-none">
                  <p class="text-gray-600 leading-relaxed">{{ member.professional_experience|safe }}</p>
                </div>
              </div>
              {% endif %}
              
              {% if member.skills %}
              <div class="space-y-2">
                <h4 class="text-lg font-semibold text-gray-900 flex items-center">
                  <svg class="w-5 h-5 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                  </svg>
                  Skills
                </h4>
                <div class="prose prose-gray max-w-none">
                  <p class="text-gray-600 leading-relaxed">{{ member.skills|safe }}</p>
                </div>
              </div>
              {% endif %}
              
              {% if member.education %}
              <div class="space-y-2">
                <h4 class="text-lg font-semibold text-gray-900 flex items-center">
                  <svg class="w-5 h-5 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l9-5-9-5-9 5 9 5z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"/>
                  </svg>
                  Education
                </h4>
                <div class="prose prose-gray max-w-none">
                  <p class="text-gray-600 leading-relaxed">{{ member.education|safe }}</p>
                </div>
              </div>
              {% endif %}
              
              {% if member.certifications %}
              <div class="space-y-2">
                <h4 class="text-lg font-semibold text-gray-900 flex items-center">
                  <svg class="w-5 h-5 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                  </svg>
                  Certifications
                </h4>
                <div class="prose prose-gray max-w-none">
                  <p class="text-gray-600 leading-relaxed">{{ member.certifications|safe }}</p>
                </div>
              </div>
              {% endif %}
              
              {% if member.publications %}
              <div class="space-y-2">
                <h4 class="text-lg font-semibold text-gray-900 flex items-center">
                  <svg class="w-5 h-5 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                  </svg>
                  Publications
                </h4>
                <div class="prose prose-gray max-w-none">
                  <p class="text-gray-600 leading-relaxed">{{ member.publications|safe }}</p>
                </div>
              </div>
              {% endif %}
            </div>
            
            <!-- Modal Footer -->
            <div class="bg-gray-50 px-6 py-4 border-t border-gray-200 flex justify-end">
              <button onclick="toggleModal('{{ forloop.counter }}')"
                      class="bg-white text-gray-700 border border-gray-300 py-2 px-6 rounded-lg hover:bg-gray-50 transition-colors duration-200 font-medium focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                Close
              </button>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  <!-- Section Divider -->
  <div class="section-divider">
    <span>Ready to work with us?</span>
  </div>

  <!-- Enhanced Join Our Team CTA -->
  <section class="bg-gradient-to-br from-blue-50 via-white to-purple-50 rounded-3xl p-8 lg:p-16 text-center border border-gray-100 shadow-xl">
    <div class="max-w-4xl mx-auto">
      <h2 class="text-3xl lg:text-4xl font-bold text-gray-900 mb-6">
        Join Our <span class="gradient-text">Team</span>
      </h2>
      <p class="text-lg lg:text-xl text-gray-600 mb-8 max-w-2xl mx-auto leading-relaxed">
        We're always looking for talented individuals who are passionate about research and data collection in Africa. 
        Be part of our mission to drive meaningful change through data-driven insights.
      </p>
      
      <div class="flex flex-col sm:flex-row justify-center gap-4 mb-8">
        <a href="{% url 'core:contact' %}" 
           class="bg-gradient-to-r from-blue-500 to-purple-600 text-white py-3 px-8 rounded-lg font-medium hover:from-blue-600 hover:to-purple-700 transition-all duration-200 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
          Get in Touch
        </a>
        <a href="#" 
           class="bg-white text-gray-700 border border-gray-300 py-3 px-8 rounded-lg font-medium hover:bg-gray-50 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
          View Open Positions
        </a>
      </div>
      
      <!-- Features -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-12">
        <div class="text-center">
          <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
            </svg>
          </div>
          <h3 class="text-lg font-semibold text-gray-900 mb-2">Collaborative Environment</h3>
          <p class="text-gray-600">Work alongside passionate professionals in a supportive, growth-oriented culture.</p>
        </div>
        
        <div class="text-center">
          <div class="bg-purple-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
          </div>
          <h3 class="text-lg font-semibold text-gray-900 mb-2">Cutting-Edge Projects</h3>
          <p class="text-gray-600">Engage with innovative research and data solutions across diverse African markets.</p>
        </div>
        
        <div class="text-center">
          <div class="bg-green-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
            </svg>
          </div>
          <h3 class="text-lg font-semibold text-gray-900 mb-2">Professional Growth</h3>
          <p class="text-gray-600">Continuous learning opportunities and career advancement in a dynamic field.</p>
        </div>
      </div>
    </div>
  </section>
</main>

<!-- Enhanced JavaScript -->
<script>
  // Modal functionality with accessibility improvements
  function toggleModal(modalId) {
    const modal = document.getElementById(`modal-${modalId}`);
    const isHidden = modal.classList.contains('hidden');
    
    if (isHidden) {
      // Show modal
      modal.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
      
      // Focus management
      const closeButton = modal.querySelector('button[onclick*="toggleModal"]');
      if (closeButton) {
        setTimeout(() => closeButton.focus(), 100);
      }
      
      // Trap focus within modal
      trapFocus(modal);
    } else {
      // Hide modal
      modal.classList.add('hidden');
      document.body.style.overflow = 'auto';
      
      // Return focus to trigger button
      const triggerButton = document.querySelector(`button[onclick*="toggleModal('${modalId}')"]`);
      if (triggerButton) {
        triggerButton.focus();
      }
    }
  }

  // Focus trap functionality for accessibility
  function trapFocus(element) {
    const focusableElements = element.querySelectorAll(
      'a[href], button, textarea, input[type="text"], input[type="radio"], input[type="checkbox"], select'
    );
    const firstFocusableElement = focusableElements[0];
    const lastFocusableElement = focusableElements[focusableElements.length - 1];

    element.addEventListener('keydown', function(e) {
      if (e.key === 'Tab') {
        if (e.shiftKey) {
          if (document.activeElement === firstFocusableElement) {
            lastFocusableElement.focus();
            e.preventDefault();
          }
        } else {
          if (document.activeElement === lastFocusableElement) {
            firstFocusableElement.focus();
            e.preventDefault();
          }
        }
      }
      
      // Close modal on Escape key
      if (e.key === 'Escape') {
        const modalId = element.id.replace('modal-', '');
        toggleModal(modalId);
      }
    });
  }

  // Enhanced scroll animations
  function initScrollAnimations() {
    const observerOptions = {
      threshold: 0.1,
      rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('animate-fade-in-up');
        }
      });
    }, observerOptions);

    // Observe team cards
    document.querySelectorAll('.team-card').forEach(card => {
      observer.observe(card);
    });
  }

  // Image lazy loading with skeleton effect
  function initImageLoading() {
    const images = document.querySelectorAll('img[loading="lazy"]');
    
    images.forEach(img => {
      // Add skeleton loading effect
      img.style.background = 'linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%)';
      img.style.backgroundSize = '200% 100%';
      img.style.animation = 'loading 1.5s infinite';
      
      img.addEventListener('load', function() {
        this.style.background = 'none';
        this.style.animation = 'none';
      });
    });
  }

  // Smooth scrolling for anchor links
  function initSmoothScrolling() {
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });
  }

  // Performance optimization: Intersection Observer for animations
  function initPerformanceOptimizations() {
    // Reduce animations on slow devices
    if (navigator.connection && navigator.connection.effectiveType === 'slow-2g') {
      document.documentElement.style.setProperty('--animation-duration', '0.1s');
    }
    
    // Respect user's motion preferences
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      document.documentElement.style.setProperty('--animation-duration', '0.01s');
    }
  }

  // Enhanced error handling for images
  function initImageErrorHandling() {
    document.querySelectorAll('img').forEach(img => {
      img.addEventListener('error', function() {
        // Create fallback avatar
        const fallback = document.createElement('div');
        fallback.className = 'w-full h-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center';
        fallback.innerHTML = `
          <svg class="w-16 h-16 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
            <path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.999a4 4 0 11-8 0 4 4 0 018 0z"/>
          </svg>
        `;
        
        this.parentNode.appendChild(fallback);
        this.style.display = 'none';
      });
    });
  }

  // Enhanced keyboard navigation
  function initKeyboardNavigation() {
    document.addEventListener('keydown', function(e) {
      // Close any open modal on Escape
      if (e.key === 'Escape') {
        const openModal = document.querySelector('[id^="modal-"]:not(.hidden)');
        if (openModal) {
          const modalId = openModal.id.replace('modal-', '');
          toggleModal(modalId);
        }
      }
    });
  }

  // Initialize all functionality when DOM is loaded
  document.addEventListener('DOMContentLoaded', function() {
    initScrollAnimations();
    initImageLoading();
    initSmoothScrolling();
    initPerformanceOptimizations();
    initImageErrorHandling();
    initKeyboardNavigation();
    
    // Add loading states for dynamic content
    const teamCards = document.querySelectorAll('.team-card');
    teamCards.forEach((card, index) => {
      card.style.animationDelay = `${index * 0.1}s`;
    });
  });

  // Service Worker registration for offline support (optional)
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      navigator.serviceWorker.register('/sw.js').then(function(registration) {
        console.log('SW registered: ', registration);
      }).catch(function(registrationError) {
        console.log('SW registration failed: ', registrationError);
      });
    });
  }
</script>

{% endblock %}